---
import Footer from "~/components/footer.astro";
import FarmImage from "~/components/farm-image.astro";
import Contrainer from "~/components/container.astro";
import { extractRSVPId } from "~/cookies";
import {
  birthday_date,
  birthday_directions_apple,
  birthday_directions_google,
  brithday_address_casusal,
} from "~/data";
import { RSVPDB } from "~/schema";
import { getRSVP } from "~/supabase";

try {
  const rsvpId = extractRSVPId(Astro.request);
  const _ = (await getRSVP(rsvpId)).data as RSVPDB;
  if (_) {
    console.log(`RSVP ID ${rsvpId} found, redirecting to RSVP page`);
    return Astro.redirect(`/rsvp/${rsvpId}`, 303);
  } else if (rsvpId) {
    console.log(`RSVP ID ${rsvpId} not found, redirecting to RSVP page`);
  }
} catch (error) {
  console.error(error);
}
---

<Contrainer>
  <div class="flex-grow pb-24 sm:pb-32">
    <div class="container mx-auto px-4 py-6">
      <div class="bg-white p-6 rounded-lg shadow-lg">
        <h1 class="text-4xl text-center text-green-600 font-bold mb-4">
          Ayalahâ€™s Barn Party
        </h1>
        <p class="text-xl text-center mb-4">{birthday_date}</p>
        <div class="text-center my-3">
          <a
            href="#rsvpForm"
            class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded mb-2 self-center"
            >RSVP Now</a
          >
        </div>
        <div class="my-4 mx-auto max-w-md md:max-w-lg lg:max-w-xl">
          <FarmImage />
        </div>
        <div class="mb-8">
          <p class="text-lg text-center mt-2">
            Potluck farm style celebration with a casual dress code.
          </p>
          <p class="text-lg text-center mt-2">
            Appreciate potluck contributions, but not required.
          </p>
          <p class="text-lg text-center mt-2">
            Appreciate any games to play indoors!
          </p>
        </div>
        <p class="text-xl text-center mb-8 ">
          {brithday_address_casusal}
        </p>
        <div class="text-center mb-4">
          <a
            href={birthday_directions_google}
            class="inline-block bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded"
            target="_blank"
          >
            Google Maps
          </a>
          <a
            href={birthday_directions_apple}
            class="inline-block bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded ml-4"
            target="_blank"
          >
            Apple Maps
          </a>
        </div>
        <div class="text-center mb-4">
          <form
            id="rsvpForm"
            action="/submit-rsvp"
            method="post"
            class="space-y-4 max-w-md mx-auto w-full"
          >
            <div>
              <label for="name" class="text-lg">Your Name:</label>
              <input
                type="text"
                id="name"
                name="name"
                required
                class="w-full p-2 border border-gray-300 rounded mt-1"
                tabindex="1"
              />
            </div>

            <div>
              <label for="email" class="text-lg">Email:</label>
              <input
                type="email"
                id="email"
                name="email"
                required
                class="w-full p-2 border border-gray-300 rounded mt-1"
                tabindex="2"
              />
            </div>

            <div>
              <label for="attendees" class="text-lg">Number of Attendees:</label
              >
              <input
                type="number"
                id="attendees"
                name="attendees"
                min="1"
                required
                class="w-full p-2 border border-gray-300 rounded mt-1"
                tabindex="3"
              />
            </div>

            <div>
              <label for="dish" class="text-lg">(optional) Dish to Share:</label>
              <input
                type="text"
                id="dish"
                name="dish"
                class="w-full p-2 border border-gray-300 rounded mt-1"
                tabindex="4"
              />
            </div>

            <div class="flex items-center">
              <input
                type="checkbox"
                id="games"
                name="games"
                tabindex="5"
                class="mr-2"
              />
              <label for="games" class="text-lg">(optional) Bringing Games</label>
            </div>

            <button
              type="submit"
              tabindex="6"
              class="w-full bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded"
              >Submit</button
            >
          </form>
        </div>
      </div>
    </div>
    <Footer />
  </div>
</Contrainer>
